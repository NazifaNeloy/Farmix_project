import{j as e,m as M,r as C,s as $,X as H,h as W}from"./ui-BW4q4lGy.js";import{r as s,h as X}from"./vendor-CxeeMcKR.js";import{a as _,u as G}from"./index-B08RLEBq.js";import"./firebase-BPVtm2U-.js";const Y=()=>{const[n,S]=s.useState(!0),[f,u]=s.useState(!1),[g,o]=s.useState(""),[m,L]=s.useState(""),[d,P]=s.useState(""),[h,E]=s.useState(""),[b,R]=s.useState(""),[p,A]=s.useState(""),[z,j]=s.useState(null),[y,v]=s.useState(null),[F,x]=s.useState(!1),l=s.useRef(null),w=s.useRef(null),{login:I,signup:U}=_(),{language:i,toggleLanguage:N,t:a}=G(),O=X(),q=async()=>{try{x(!0);const t=await navigator.mediaDevices.getUserMedia({video:!0});l.current&&(l.current.srcObject=t)}catch(t){console.error("Camera error:",t),o(a("auth.error.camera")),x(!1)}},T=()=>{if(l.current){const t=document.createElement("canvas");t.width=l.current.videoWidth,t.height=l.current.videoHeight,t.getContext("2d").drawImage(l.current,0,0),t.toBlob(r=>{const c=new File([r],"profile_capture.jpg",{type:"image/jpeg"});j(c),v(URL.createObjectURL(r)),k()},"image/jpeg")}},k=()=>{l.current&&l.current.srcObject&&l.current.srcObject.getTracks().forEach(r=>r.stop()),x(!1)},B=t=>{const r=t.target.files[0];r&&(j(r),v(URL.createObjectURL(r)))},D=async t=>{t.preventDefault(),o(""),u(!0);const r=setTimeout(()=>{u(!1),o(a("auth.error.timeout"))},3e4);try{console.log("Attempting authentication..."),n?await I(m,d):await U(m,d,h,b,i,p,z),clearTimeout(r),console.log("Authentication successful, navigating..."),O("/harvest")}catch(c){clearTimeout(r),console.error("Auth Error:",c),c.code==="auth/email-already-in-use"?o(a("auth.error.exists")):o(c.message)}finally{u(!1)}};return e.jsx("div",{className:"min-h-screen bg-farm-cream font-inter flex flex-col",children:e.jsx("main",{className:"flex-grow flex items-center justify-center p-4 pt-24",children:e.jsxs(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white p-8 rounded-3xl shadow-xl w-full max-w-md my-8 border border-gray-100",children:[e.jsx("h2",{className:"text-3xl font-playfair font-bold text-farm-dark mb-6 text-center",children:a(n?"auth.welcomeBack":"auth.joinFarmix")}),g&&e.jsx("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg mb-4 text-sm",children:g}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[!n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center mb-4",children:[e.jsx("div",{className:"relative w-24 h-24 bg-gray-50 rounded-full overflow-hidden mb-3 border-2 border-farm-lime",children:y?e.jsx("img",{src:y,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:e.jsx(C,{size:32})})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"file",ref:w,className:"hidden",accept:"image/*",onChange:B}),e.jsxs("button",{type:"button",onClick:()=>w.current.click(),className:"px-3 py-1.5 bg-gray-100 text-xs font-medium rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-1",children:[e.jsx(C,{size:14})," ",a("auth.upload")]}),e.jsxs("button",{type:"button",onClick:q,className:"px-3 py-1.5 bg-farm-lime/20 text-farm-dark text-xs font-medium rounded-lg hover:bg-farm-lime/30 transition-colors flex items-center gap-1",children:[e.jsx($,{size:14})," ",a("auth.camera")]})]}),F&&e.jsxs("div",{className:"fixed inset-0 bg-black/90 z-50 flex flex-col items-center justify-center p-4",children:[e.jsxs("div",{className:"relative w-full max-w-sm aspect-[3/4] bg-black rounded-2xl overflow-hidden mb-4",children:[e.jsx("video",{ref:l,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:k,className:"absolute top-4 right-4 p-2 bg-black/50 text-white rounded-full",children:e.jsx(H,{size:24})})]}),e.jsx("button",{type:"button",onClick:T,className:"w-16 h-16 bg-white rounded-full border-4 border-gray-300 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 bg-farm-lime rounded-full"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("auth.fullName")}),e.jsx("input",{type:"text",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-farm-lime outline-none",value:h,onChange:t=>E(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("auth.phone")}),e.jsx("input",{type:"tel",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-farm-lime outline-none",value:b,onChange:t=>R(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("auth.location")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:a("auth.locationPlaceholder"),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-farm-lime outline-none pl-10",value:p,onChange:t=>A(t.target.value)}),e.jsx(W,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("auth.preferredLanguage")}),e.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-xl",children:[e.jsx("button",{type:"button",onClick:()=>i!=="bn"&&N(),className:`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${i==="bn"?"bg-white shadow-sm text-farm-dark":"text-gray-500"}`,children:"বাংলা (BN)"}),e.jsx("button",{type:"button",onClick:()=>i!=="en"&&N(),className:`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${i==="en"?"bg-white shadow-sm text-farm-dark":"text-gray-500"}`,children:"English (EN)"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("auth.email")}),e.jsx("input",{type:"email",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-farm-lime outline-none",value:m,onChange:t=>L(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a("auth.password")}),e.jsx("input",{type:"password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-farm-lime outline-none",value:d,onChange:t=>P(t.target.value)})]}),e.jsx("button",{type:"submit",disabled:f,className:"w-full bg-farm-lime text-farm-dark py-3 rounded-xl font-bold hover:bg-opacity-80 transition-colors disabled:opacity-50 shadow-lg hover:shadow-farm-lime/20",children:a(f?"auth.processing":n?"auth.login":"auth.register")})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>S(!n),className:"text-farm-dark font-medium hover:underline",children:a(n?"auth.noAccount":"auth.hasAccount")})})]})})})};export{Y as default};
