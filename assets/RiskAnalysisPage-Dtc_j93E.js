import{j as e,ab as j,B as b,G as v}from"./ui-BW4q4lGy.js";import{r as n,L as x}from"./vendor-CxeeMcKR.js";import{u as N,b as k,a as w}from"./index-B08RLEBq.js";import{c as P,R,f as W,g as A}from"./weatherService--djAQi4h.js";import"./firebase-BPVtm2U-.js";const F=()=>{const{t:a}=N(),{batches:g,completeBatch:h}=k(),{userData:d}=w(),[p,f]=n.useState(null),[u,y]=n.useState(!0),m=g.filter(s=>!s.status||s.status==="Active"||s.status==="Processing");return n.useEffect(()=>{(async()=>{try{const r=d?.location?.split(",")[0]||"Dhaka",i=await W(r),l=A(i);f({...i,forecast:l})}catch(r){console.error("Weather load failed for risk calc:",r)}finally{y(!1)}})()},[d?.location]),e.jsx("div",{className:"min-h-screen bg-gray-50 font-inter",children:e.jsxs("main",{className:"container mx-auto px-4 py-8 pt-24",children:[e.jsxs("div",{className:"mb-8 flex items-center gap-4",children:[e.jsx(x,{to:"/harvest",className:"p-2 bg-white rounded-full hover:bg-gray-100 transition-colors shadow-sm",children:e.jsx(j,{size:20,className:"text-gray-600"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(b,{className:"text-farm-lime",size:28}),a("riskPage.title")]}),e.jsx("p",{className:"text-gray-500 text-sm",children:a("riskPage.subtitle")})]})]}),u?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-farm-lime border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-gray-500",children:a("riskPage.loading")})]}):e.jsx("div",{className:"space-y-6",children:m.length===0?e.jsxs("div",{className:"text-center py-16 bg-white rounded-2xl border border-dashed border-gray-200 shadow-sm",children:[e.jsx(v,{className:"mx-auto text-gray-300 mb-4",size:48}),e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-2",children:a("riskPage.noBatches.title")}),e.jsx("p",{className:"text-gray-500 mb-6",children:a("riskPage.noBatches.desc")}),e.jsx(x,{to:"/harvest",className:"px-6 py-2 bg-farm-lime text-farm-dark font-bold rounded-full hover:bg-lime-400 transition-colors",children:a("riskPage.noBatches.cta")})]}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map(s=>{const r=s.cropType||s.crop||"",i=r.trim()==="Demo Potato"||r.includes("Demo Potato"),l={current:{temp:28,humidity:90,weather:"Rain"},forecast:Array(7).fill({date:new Date().toISOString(),temp:28,rainProb:80,humidity:90,weather:"Rain",weatherCode:61})},o=p||(i?l:null),c=i&&o?{...o,current:{...o.current,humidity:90,temp:28},forecast:[{...o.forecast[0],weather:"Rain",weatherCode:61},...o.forecast.slice(1)]}:o;let t=c?P(s,c):null;return i&&c&&t&&(t={...t,riskLevel:"CRITICAL",color:"red",advice:t.advice.includes("Rain")?t.advice:"CRITICAL: Heavy rain and high humidity detected. Immediate action required to prevent spoilage."}),t?e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-gray-900",children:s.cropType||s.crop}),e.jsx("p",{className:"text-sm text-gray-500",children:s.variety})]}),e.jsxs("span",{className:"bg-gray-100 px-3 py-1 rounded-full text-xs font-bold text-gray-600",children:[s.weight," kg"]})]}),e.jsx(R,{batch:s,riskData:t}),e.jsx("button",{onClick:async()=>{if(window.confirm(a("riskPage.confirmComplete")))try{await h(s.id)}catch{alert("Failed to complete batch")}},className:"w-full mt-2 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold rounded-xl transition-colors text-sm",children:a("riskPage.completeBatch")}),e.jsxs("div",{className:"pt-4 border-t border-gray-50 grid grid-cols-2 gap-4 text-xs text-gray-500",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-gray-400 mb-1",children:a("riskPage.harvestDate")}),e.jsx("span",{className:"font-medium text-gray-700",children:s.harvestDate})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-gray-400 mb-1",children:a("riskPage.storage")}),e.jsx("span",{className:"font-medium text-gray-700",children:s.storageType||a("riskPage.openAir")})]})]})]},s.id):null})})})]})})};export{F as default};
